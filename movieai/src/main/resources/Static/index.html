<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Movie AI App</title>
</head>
<body>
<h1>Movie AI App</h1>

<form id="movieForm">
    <label>Movie Title:</label><br>
    <input type="text" id="title" name="title" required><br><br>

    <label>Rating (1â€“10):</label><br>
    <input type="number" id="rating" name="rating" step="0.1" min="1" max="10" required><br><br>

    <button type="submit">Add Movie</button>
</form>

<br>
<button onclick="loadMovies()">View All Movies</button>

<div id="movieList"></div>

<script>
    // This function handles form submission
    async function handleSubmit(event) {
      event.preventDefault(); // prevent form from reloading the page

      const title = document.getElementById("title").value;
      const rating = parseFloat(document.getElementById("rating").value);

      const movieData = { title, rating };

      try {
        // Send data to backend
        const response = await fetch("/movies/add", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(movieData)
        });

        if (response.ok) {
          alert("Movie added successfully!");
          document.getElementById("movieForm").reset();
          document.getElementById("movieList").innerHTML = "";
        } else {
          alert("Error adding movie.");
        }
      } catch (error) {
        console.error("Error:", error);
        alert("Something went wrong.");
      }
    }

    // Attach the function to the form submit event
    document.getElementById("movieForm").addEventListener("submit", handleSubmit);

    // Function to fetch and display all movies
    async function loadMovies() {
      const response = await fetch("/movies/all");
      const movies = await response.json();

      const listDiv = document.getElementById("movieList");
      listDiv.innerHTML = "";

      movies.forEach(movie => {
        const div = document.createElement("div");
        div.innerHTML = `
          <p><b>${movie.title}</b> (${movie.rating}/10)</p>
          <p>${movie.aiDescription}</p>
          <hr>
        `;
        listDiv.appendChild(div);
      });
    }

    // Automatically show movies when page loads
    loadMovies();
</script>
</body>
</html>
